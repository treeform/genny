name: Node
on:
  push:
    branches: [master]
  pull_request:
    branches: [master]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'
    - name: Setup Nim
      uses: treeform/setup-nim-action@v6
    - name: Build shared library
      run: nim c --mm:arc --app:lib -d:gennyNode -o:tests/generated/libtest.so tests/test.nim
    - name: Install koffi
      working-directory: tests
      run: npm install koffi
    - name: Run tests
      working-directory: tests
      run: node test_node.js
